> [0. Acerca del Grupo](../../0.md) ‚Ä∫ [0.6. Temas Individuales (Parte 1)](../0.6.md) ‚Ä∫ [0.6.1. Integrante 1](0.6.1.md)

# 0.6.1. Integrante 1

# Manejo de Datos Geoespaciales
## PostGIS, GeoJSON, Node.js (Express) y Leaflet

# 1. Desarrollo Conceptual

## 1.1 ¬øQu√© son los Datos Geoespaciales?
Los datos geoespaciales describen objetos o fen√≥menos con ubicaci√≥n en la Tierra. Combinan:
- Posici√≥n: coordenadas (latitud/longitud o X/Y).
- Atributos: propiedades descriptivas (nombre, categor√≠a, etc.).
- Tiempo (opcional): cu√°ndo suceden.

Habilitan an√°lisis espaciales (distancias, contenci√≥n, intersecciones) en Sistemas de Informaci√≥n Geogr√°fica (GIS).

## 1.2 Tipos de Datos Geoespaciales
- **Vectorial**: entidades discretas.
  - Point: ubicaci√≥n puntual (ej.: un restaurante).
  - LineString: secuencia de puntos conectados (ej.: una avenida).
  - Polygon: un √°rea cerrada (ej.: zona de cobertura).
  - Colecciones: MultiPoint, MultiLineString, MultiPolygon, GeometryCollection.
- **Raster**: grillas de celdas (im√°genes satelitales, DEM, temperatura). Cada p√≠xel tiene un valor.

## 1.3 Sistemas de Referencia de Coordenadas (CRS)
- **Sistemas Geogr√°ficos** (angulares): WGS84 `EPSG:4326` (lat/lon), est√°ndar global.
- **Sistemas Proyectados** (planos): UTM, Web Mercator `EPSG:3857` para mapas web.

Consideraci√≥n: en geogr√°ficas (grados) las distancias/√°reas se calculan sobre el elipsoide; en proyectadas se usan c√°lculos planos.

## 1.4 Geometr√≠a vs Geograf√≠a (en PostGIS)
- **geometry**: modelo plano; m√°s r√°pido; ideal con proyecciones locales (p. ej., UTM) para performance.
- **geography**: modelo esf√©rico; distancias/√°reas en metros con mayor precisi√≥n global; m√°s costo de c√≥mputo.

En este proyecto se usa `GEOGRAPHY(..., 4326)` para puntos y pol√≠gonos, lo cual facilita consultas por radio en metros.

## 1.5 Operaciones Espaciales Fundamentales
- **Consulta**: `ST_Distance`, `ST_Area`, `ST_Length`, `ST_Centroid`.
- **Relaci√≥n**: `ST_Contains`, `ST_Within`, `ST_Intersects`, `ST_Overlaps`, `ST_Touches`.
- **Transformaci√≥n**: `ST_Buffer`, `ST_Union`, `ST_Intersection`, `ST_Difference`, `ST_Transform`.

## 1.6 √çndices Espaciales
- **GiST (Generalized Search Tree)**: base de los √≠ndices espaciales en PostGIS.
- Beneficio: aceleran queries reduciendo escaneos completos a b√∫squedas logar√≠tmicas.
- En el proyecto: √≠ndices GIST en `lugares.ubicacion` y `zonas_cobertura.geometria`.

## 1.7 Formatos de Intercambio
- **WKT/WKB**: texto/binario bien conocidos.
- **GeoJSON**: est√°ndar web; `FeatureCollection` -> `features` con `geometry` y `properties`.

## 1.8 Patrones Arquitect√≥nicos
- Arquitectura en capas: Presentaci√≥n (Leaflet) ‚Üí API (Express) ‚Üí L√≥gica espacial (PostGIS) ‚Üí Datos (PostgreSQL).
- Microservicios geoespaciales: geocodificaci√≥n, ruteo, tiles, an√°lisis, streaming.
- Tile servers: teselado XYZ, cach√©; no incluido en este proyecto, pero integrable.

---

# 2. Consideraciones T√©cnicas (Proyecto Actual)

## 2.1 Visi√≥n General del Proyecto
- **Repositorio**: ra√≠z `tema-individual/`.
- **Componentes**:
  - Base de datos: `PostgreSQL + PostGIS` en Docker (`docker-compose.yml`).
  - Backend API: `Node.js + Express` en `backend/`.
  - Frontend: `Leaflet` en `frontend/index.html`, servido por el backend.
- **Flujo**: Frontend consume API REST ‚Üí API ejecuta consultas espaciales en PostGIS ‚Üí responde GeoJSON ‚Üí Leaflet renderiza mapa y capas.

## 2.2 Puesta en Marcha (Local)
- Requisitos: Docker/Compose, Node.js >= 18.
- Paso 1: levantar la BD
```
docker-compose up -d
```
- Paso 2: verificar PostGIS
```
docker exec geospatial-db psql -U geouser -d geodata -c "SELECT PostGIS_Version();"
```
- Paso 3: instalar e iniciar backend
```
cd backend
npm install
npm start
```
- Acceso:
  - Frontend/API: `http://localhost:3002/` y `http://localhost:3002/api`.

## 2.3 Pruebas R√°pidas
- Salud:
```
curl http://localhost:3002/api/health
```
- Categor√≠as:
```
curl http://localhost:3002/api/categorias
```
- Lugares (GeoJSON):
```
curl http://localhost:3002/api/lugares
```
- Cercanos (2km desde Plaza Mayor):
```
curl "http://localhost:3002/api/lugares/cercanos?lat=-12.0464&lng=-77.0428&radius=2000"
```
- Crear lugar:
```
curl -X POST http://localhost:3002/api/lugares \
  -H "Content-Type: application/json" \
  -d '{
    "nombre":"Punto de prueba",
    "categoria":"Caf√©",
    "lat":-12.05,
    "lng":-77.04,
    "rating":4.2
  }'
```
---

# 3. Implementaci√≥n y Demostraci√≥n

## 3.1 Estructura del Proyecto
```
.
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ start.sh
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ init.sql
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ server.js
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.js
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îú‚îÄ‚îÄ lugares.js
‚îÇ       ‚îî‚îÄ‚îÄ zonas.js
‚îî‚îÄ‚îÄ frontend/
    ‚îî‚îÄ‚îÄ index.html
```

## 3.2 Consultas SQL de Ejemplo (PostGIS)
- Lugares por cercan√≠a:
```
SELECT 
  l.nombre,
  c.nombre AS categoria,
  ROUND(ST_Distance(
    l.ubicacion,
    ST_GeogFromText('POINT(-77.0428 -12.0464)')
  )::numeric, 2) AS distancia_m
FROM lugares l
LEFT JOIN categorias c ON l.categoria_id = c.id
ORDER BY distancia_m
LIMIT 5;
```
- Lugares dentro de una zona espec√≠fica:
```
SELECT l.*
FROM lugares l
WHERE ST_Within(
  l.ubicacion::geometry,
  (SELECT geometria::geometry FROM zonas_cobertura WHERE id = 1)
);
```
- √Åreas de zonas (m¬≤):
```
SELECT nombre, ROUND(ST_Area(geometria)::numeric, 2) AS area_m2
FROM zonas_cobertura;
```

---

# 4. Escalabilidad y Arquitectura

## 4.1 Estrategias de Escalamiento
- Vertical: ajustar `work_mem`, `maintenance_work_mem`, pooling de conexiones (`pgbouncer`).
- Horizontal: r√©plicas de lectura; partici√≥n por regi√≥n; cache de consultas.

## 4.2 Diagrama de Flujo
```mermaid
flowchart LR
  A[frontend/index.html - Leaflet] -- fetch GeoJSON --> B[Express API /api/*]
  B -- pg Pool --> C[(PostgreSQL + PostGIS)]
  C -- ST_AsGeoJSON / ST_DWithin / ST_Distance --> B
  B -- JSON/GeoJSON --> A
```
---

# 5. Anexos

## 5.1 Comandos √ötiles
- Ver versi√≥n PostGIS (contenedor):
```
docker exec geospatial-db psql -U geouser -d geodata -c "SELECT PostGIS_Version();"
```
- Logs del contenedor:
```
docker logs geospatial-db
```
- Backup/restore:
```
docker exec geospatial-db pg_dump -U geouser -d geodata > backup.sql
cat backup.sql | docker exec -i geospatial-db psql -U geouser -d geodata
```
- Servir un directorio simple (√∫til para pruebas):
```
python3 -m http.server 8080
```
---

# 6. Referencias
- PostGIS: https://postgis.net/documentation/
- PostgreSQL: https://www.postgresql.org/docs/
- RFC 7946 GeoJSON: https://datatracker.ietf.org/doc/html/rfc7946
- Leaflet: https://leafletjs.com/
- QGIS: https://qgis.org/


---

![demo](./images/demo.png)

[üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../0.6.2/0.6.2.md)