> [5. T√°cticas](../5.md) ‚Ä∫ [5.4. M√≥dulo 4 / Integrante 4](5.4.md)

# 5.3. M√≥dulo 4 / Integrante 4

---

# **Escenario 1 ‚Äì Disponibilidad (ESC-01)**

## **Escenario**

| Atributo           | ID Escenario | Fuente Est√≠mulo                   | Est√≠mulo                                                      | Artefacto                      | Entorno                           | Respuesta                                         | Medida de Respuesta | Comentario                                 |
| ------------------ | ------------ | --------------------------------- | ------------------------------------------------------------- | ------------------------------ | --------------------------------- | ------------------------------------------------- | ------------------- | ------------------------------------------ |
| **Disponibilidad** | **ESC-01**   | Usuario con conexi√≥n intermitente | P√©rdida de conectividad o falla de servicio al crear/publicar | M√≥dulo de Publicaci√≥n de Ideas | Uso normal con conexi√≥n inestable | Se autoguarda y recupera borrador al reconectarse | Recuperaci√≥n ‚â§ 5 s  | Evita p√©rdida de trabajo, mejora confianza |

## **T√°ctica Elegida**

**Almacenamiento de Estado (Cache/Local Storage o IndexedDB).**

### **T√≠tulo**

T√°ctica de Autoguardado Local para Garantizar la Recuperaci√≥n de Borradores (ESC-01)

### **Contexto**

* Los usuarios redactan ideas largas (**HU003**).
* El requisito **RF009** exige autoguardado cada 30 segundos.
* La intermitencia (ESC-01) no debe provocar p√©rdida de trabajo.

### **Alternativas**

1. **Estado Local (Cache/IndexedDB)**

   * Guarda borradores localmente.
   * Recuperaci√≥n inmediata al reconectarse.
2. **Registro de Transacciones en Servidor Auxiliar**

   * Uso de Kafka u otro broker para registrar cada pulsaci√≥n.
   * Mucha complejidad e infraestructura adicional.

### **Criterios**

* Recuperaci√≥n r√°pida (‚â§ 5 s).
* Bajo costo e independencia del servidor.
* Minimizar p√©rdida de datos.

### **Decisi√≥n**

Se adopta **Almacenamiento Local Persistente** en cliente (IndexedDB/AsyncStorage).

### **Sustento**

La recuperaci√≥n es instant√°nea porque los datos ya est√°n en el dispositivo.
Evita dependencia del servidor ante fallas y cumple estrictamente ESC-01.

---

# **Escenario 2 ‚Äì Seguridad (ESC-06)**

## **Escenario**

| Atributo      | ID Escenario | Fuente Est√≠mulo        | Est√≠mulo                                 | Artefacto         | Entorno        | Respuesta                               | Medida de Respuesta | Comentario                       |
| ------------- | ------------ | ---------------------- | ---------------------------------------- | ----------------- | -------------- | --------------------------------------- | ------------------- | -------------------------------- |
| **Seguridad** | **ESC-06**   | Atacante externo / bot | Fuerza bruta o spam de creaci√≥n de ideas | Servidor de Ideas | Acceso externo | Bloquea y registra intentos sospechosos | Bloqueo ‚â§ 2 s       | Protege reputaci√≥n y estabilidad |

## **T√°ctica Elegida**

**Limitar el Acceso ‚Äì Rate Limiting**

### **T√≠tulo**

Implementaci√≥n de Rate Limiting para mitigar Ataques de Fuerza Bruta y Spam (ESC-06)

### **Contexto**

* Endpoints cr√≠ticos (crear idea, autenticaci√≥n) son vulnerables.
* Se requiere bloquear spam masivo en ‚â§ 2 s.

### **Alternativas**

1. **Rate Limiting (API Gateway)**

   * Limita solicitudes por IP/usuario.
   * Muy r√°pido y efectivo.
2. **Autenticaci√≥n/Autorizaci√≥n m√°s estricta**

   * Necesario, pero no detiene bots no autenticados.

### **Criterios**

* Respuesta inmediata ante abuso.
* Bajo costo de procesamiento.
* Mitigaci√≥n de spam y fuerza bruta.

### **Decisi√≥n**

Implementar Rate Limiting en el API Gateway antes del microservicio de Ideas.

### **Sustento**

Bloquea en tiempo real patrones de solicitudes anormales.
Registro en bit√°cora y protecci√≥n proactiva del servicio.

---

# **Escenario 3 ‚Äì Testabilidad (ESC-09)**

## **Escenario**

| Atributo         | ID Escenario | Fuente Est√≠mulo | Est√≠mulo                                 | Artefacto                  | Entorno      | Respuesta                               | Medida de Respuesta        | Comentario               |
| ---------------- | ------------ | --------------- | ---------------------------------------- | -------------------------- | ------------ | --------------------------------------- | -------------------------- | ------------------------ |
| **Testabilidad** | **ESC-09**   | Equipo QA       | Pruebas automatizadas en flujos cr√≠ticos | M√≥dulo de Ideas en Staging | Ejecuci√≥n QA | Soporte para mocks, logs y trazabilidad | Respuesta ‚â§ 2 s por prueba | Asegura calidad continua |

## **T√°ctica Elegida**

**Separar Preocupaciones (MVC / Capas)**

### **T√≠tulo**

Uso del Patr√≥n MVC para mejorar Testabilidad del Microservicio (ESC-09)

### **Contexto**

* QA debe probar flujos cr√≠ticos r√°pido y de manera aislada.
* Se necesitan mocks de base de datos y servicios externos.

### **Alternativas**

1. **Separaci√≥n por Capas (MVC/Repository-Service)**

   * Permite pruebas unitarias aisladas.
2. **Entorno completo de pruebas**

   * Costoso y lento, no cumple ‚â§2 s.

### **Criterios**

* Aislamiento.
* Facilidad para mockear.
* Arquitectura compatible con microservicios.

### **Decisi√≥n**

Aplicar MVC (controladores, servicios, repositorios).

### **Sustento**

La l√≥gica de negocio se prueba de forma aislada.
Cumple respuesta r√°pida y 100% trazabilidad requerida en ESC-09.

---
# **Escenario 4 ‚Äì Rendimiento (ESC-06)**

| Atributo | ID Escenario | Fuente Est√≠mulo | Est√≠mulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Rendimiento** | **ESC-06** | Usuario Final | Muchos usuarios env√≠an solicitudes de ‚ÄúPublicar Idea‚Äù al mismo tiempo | Broker de Mensajer√≠a / API Gateway | Carga Alta (Pico de tr√°fico) | La solicitud se env√≠a a una cola as√≠ncrona para procesarla sin esperar; el usuario recibe confirmaci√≥n r√°pida | Confirmaci√≥n en \<200 ms; procesamiento en segundo plano | Evita el bloqueo del hilo principal y mejora la percepci√≥n de velocidad del usuario |

### T√°ctica Elegida

La t√°ctica elegida es **Introducir Concurrencia**, espec√≠ficamente mediante el uso de colas de mensajes para procesamiento as√≠ncrono.

**T√≠tulo**:

  - Desacoplamiento de la Publicaci√≥n mediante Colas de Mensajer√≠a (RabbitMQ).

**Contexto**:

  - Al recibir un est√≠mulo masivo (ESC-06), procesar cada inserci√≥n en base de datos de forma s√≠ncrona saturar√≠a el Gateway. Se requiere liberar la conexi√≥n HTTP inmediatamente.

**Alternativas**:

1.  **Introducir Concurrencia (Colas de Mensajes - RabbitMQ)**:
      - El Gateway recibe la petici√≥n y delega la tarea al `IDEAS_SERVICE` v√≠a RabbitMQ.
      - **Pro:** La respuesta al cliente es inmediata (Ack), independientemente de cu√°nto tarde la base de datos.
2.  **Aumentar Recursos (Escalabilidad Vertical)**:
      - Aumentar CPU/RAM del servidor del Gateway.
      - **Contra:** Es costoso y tiene un l√≠mite f√≠sico; no soluciona el cuello de botella de bloqueo de I/O.
3.  **R√©plicas de Servicio (Escalabilidad Horizontal sin Colas)**:
      - Balancear carga entre m√∫ltiples instancias de `IDEAS_SERVICE` v√≠a HTTP directo.
      - **Contra:** Si el servicio de base de datos se satura, las peticiones HTTP fallar√°n por *timeout* en cascada.

**Criterios de Elecci√≥n**:

  - Minimizar la latencia percibida por el usuario (\< 200ms).
  - Desacoplamiento temporal (el servicio de ideas puede estar lento sin afectar la recepci√≥n de solicitudes).
  - Capacidad de *buffering* (amortiguar picos de carga).

**Decisi√≥n**:

  - Se mantiene y valida la implementaci√≥n actual de **Introducir Concurrencia** usando `ClientsModule` con transporte `RMQ` configurada en el `api-gateway`.

**Sustento**:

  - Esta t√°ctica permitira que el Gateway responda al usuario casi instant√°neamente mientras el mensaje viaja por la cola, cumpliendo con la medida de respuesta de \<200ms y protegiendo el sistema de ca√≠das por saturaci√≥n.

-----

## Escenario 2: Seguridad

| Atributo | ID Escenario | Fuente Est√≠mulo | Est√≠mulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Seguridad** | **ESC-07** | Atacante Interno | Intenta publicar una idea usando un ID de autor que no le pertenece | Servicio de Identidad / BD Relacional | Operaci√≥n normal | El sistema valida el autor y rechaza IDs falsos o suplantados | Respuesta HTTP 401/403 inmediata | Garantiza la integridad de la autor√≠a y evita suplantaci√≥n de identidad |

### T√°ctica Elegida

La t√°ctica elegida es **Autenticar Actores**, delegando la validaci√≥n de identidad a un proveedor robusto.

**T√≠tulo**:

  - Validaci√≥n de Identidad Centralizada v√≠a Token JWT (Supabase Auth).

**Contexto**:

  - En el flujo de publicaci√≥n, el cliente m√≥vil env√≠a un JSON que incluye el `authorId`. Un atacante podr√≠a modificar este JSON antes de enviarlo. El sistema debe desconfiar de la entrada del usuario y verificar que quien env√≠a la petici√≥n es realmente quien dice ser.

**Alternativas**:

1.  **Autenticar Actores (Delegaci√≥n a Proveedor de Identidad)**:
      - Utilizar un servicio especializado (Supabase/Firebase) que emita tokens JWT firmados. El backend valida la firma del token antes de aceptar cualquier operaci√≥n.
      - **Pro:** Reduce la superficie de ataque y externaliza la complejidad criptogr√°fica.
2.  **Gesti√≥n de Sesiones Propia (Cookies/Session ID)**:
      - Crear una tabla de sesiones en base de datos propia.
      - **Contra:** Requiere mantenimiento de estado en el servidor (menos escalable) y mayor riesgo de errores de implementaci√≥n de seguridad.

**Criterios de Elecci√≥n**:

  - Seguridad robusta (est√°ndares de industria OIDC/OAuth).
  - Facilidad de integraci√≥n en microservicios (stateless).
  - Prevenci√≥n efectiva de suplantaci√≥n (spoofing).

**Decisi√≥n**:

  - Se implementa la t√°ctica de **Autenticar Actores** utilizando `SupabaseService` para verificar la sesi√≥n del usuario.

**Sustento**:

  - Esta t√°ctica asegura que cada petici√≥n cr√≠tica pase por una verificaci√≥n de credenciales v√°lida.

-----

## Escenario 3: Mantenibilidad

| Atributo | ID Escenario | Fuente Est√≠mulo | Est√≠mulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Mantenibilidad** | **ESC-10** | Equipo de Producto | Se necesita agregar campos complejos a la estructura de una idea (ej. portafolio) | Base de Datos Documental (MongoDB) | Tiempo de desarrollo | Se agregan campos anidados sin migraciones r√≠gidas | Cambios r√°pidos sin downtime | Facilita la evoluci√≥n del producto sin deuda t√©cnica de base de datos |

### T√°ctica Elegida

La t√°ctica elegida es **Anticipar Cambios Esperados**, mediante el uso de esquemas flexibles (Defer Binding).

**T√≠tulo**:

  - Uso de Persistencia Pol√≠glota con Esquema Flexible (MongoDB) para Evoluci√≥n de Datos.

**Contexto**:

  - Las "Ideas" en Nexus son entidades vivas que pueden requerir nuevos atributos (videos, archivos adjuntos, co-autores) a medida que el negocio evoluciona. Usar una base de datos relacional r√≠gida obligar√≠a a realizar `ALTER TABLE` costosos y migraciones complejas cada vez que el equipo de producto pida un cambio (ESC-10).

**Alternativas**:

1.  **Anticipar Cambios (Base de Datos Documental / NoSQL)**:
      - Utilizar MongoDB para almacenar las ideas como documentos JSON.
      - **Pro:** Permite agregar campos nuevos (ej. `portfolio`, `files`) sin romper la compatibilidad con registros antiguos y sin detener la base de datos.
2.  **Generalizar el M√≥dulo (Modelo EAV en SQL)**:
      - Usar tablas relacionales de tipo Entidad-Atributo-Valor.
      - **Contra:** Hace que las consultas sean extremadamente lentas y complejas de mantener.
3.  **Restringir Cambios**:
      - Rechazar requerimientos de nuevos campos hasta una "versi√≥n 2.0".
      - **Contra:** Afecta negativamente la agilidad del negocio.

**Criterios de Elecci√≥n**:

  - Flexibilidad del esquema de datos.
  - Facilidad para representar estructuras jer√°rquicas (arrays de objetos).
  - Velocidad de desarrollo ante cambios de requisitos.

**Decisi√≥n**:

  - Se aplica la t√°ctica de **Anticipar Cambios Esperados** utilizando MongoDB
**Sustento**:

  - Esta estructura permite que, si ma√±ana se requiere agregar un campo "previewUrl" a los archivos, se pueda hacer directamente en el c√≥digo sin ejecutar scripts de migraci√≥n en la base de datos, satisfaciendo el requerimiento de mantenibilidad y evoluci√≥n r√°pida.s
---

[‚¨ÖÔ∏è Anterior](../5.3/5.3.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../5.5/5.5.md)
