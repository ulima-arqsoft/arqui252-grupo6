> [5. Tácticas](../5.md) › [5.4. Módulo 4 / Integrante 4](5.4.md)

# 5.4. Módulo 4 / Integrante 4

## Escenario
| Atributo | ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Disponibilidad** | **ESC-01** | Usuario con conexión intermitente | Usuario pierde conectividad o falla un servicio auxiliar al crear/publicar | Módulo de Publicación de Ideas | Uso normal con conexión inestable | El sistema autoguarda y recupera borrador al reconectarse, notificando al usuario | Recuperación en ≤ 5 seg tras reconexión | Evita pérdida de trabajo, crítico para confianza del usuario |

### Táctica Elegida
La táctica elegida es **Almacenamiento de Estado (Cache/Local)**, que permite a la interfaz de usuario guardar una copia del borrador localmente y sincronizarlo al reconectarse.

**Título**:
- Táctica de Autoguardado Local para Garantizar la Recuperación de Borradores (ESC-01).

**Contexto**:
- Los usuarios de NEXUS pueden tardar tiempo en redactar sus ideas (HU003), que son extensas y detalladas. El requisito funcional **RF009** exige un autoguardado cada 30 segundos. La pérdida de conectividad (ESC-01) o la falla del servidor auxiliar no debe resultar en la pérdida de trabajo, ya que esto impactaría directamente la confianza del usuario.

**Alternativas**:
1. **Almacenamiento de Estado Local (Cache/IndexDB)**:
    - La aplicación cliente (**React Native / Next.js**) guarda activamente los cambios en el almacenamiento persistente del dispositivo. Cuando la conexión se recupera, el cliente intenta sincronizar el borrador guardado localmente con el servidor.
    - Proporciona una recuperación inmediata e independiente de la conectividad del servidor.
2. **Registro de Transacciones en Servidor Auxiliar**:
    - Usar un servicio de mensajería asíncrona (ej. Kafka) para registrar cada pequeña pulsación de tecla y reconstruir el borrador en el servidor en caso de falla.
    - Requiere alta complejidad de infraestructura y consume más recursos del servidor.

**Criterios de Elección**:
- Velocidad de recuperación para el usuario (≤ 5 seg).
- Simplicidad y costo de implementación (favorecer el lado del cliente).
- Minimizar el riesgo de pérdida de datos ante intermitencia.

**Decisión**:
- Se elige la táctica de **Almacenamiento de Estado Local (Local Cache)**, utilizando las capacidades de almacenamiento persistente del navegador o la plataforma móvil.

**Sustento**:
- La **recuperación de 5 segundos** es más factible utilizando un estado ya presente en el dispositivo del usuario. Almacenar el borrador en el *Local Storage* de la aplicación permite que la recuperación sea inmediata al restablecerse la conectividad, simplemente cargando la versión local y presentando el aviso al usuario. Esto aísla al usuario de la falla del servicio auxiliar o la intermitencia de la red, siendo la solución más simple y directa para el escenario ESC-01.

---

## Escenario
| Atributo | ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Rendimiento** | **ESC-02** | Carga masiva de usuarios | Pico masivo de tráfico con miles de usuarios concurrentes | Servidor principal del Módulo de Publicación de Ideas | Evento de alta concurrencia | El sistema escala horizontalmente manteniendo respuesta aceptable | Disponibilidad ≥ 90% | Garantiza confiabilidad en momentos críticos |

### Táctica Elegida
La táctica elegida es **Replicación de Componentes** (Escalamiento Horizontal), que permite distribuir la carga de las solicitudes de creación y edición.

**Título**:
- Uso de Replicación Activa para Escalamiento Horizontal en el Microservicio de Ideas (ESC-02).

**Contexto**:
- NEXUS espera picos de tráfico ante eventos de marketing o grandes lanzamientos (ESC-02). El Módulo 2 debe manejar miles de usuarios creando y editando ideas simultáneamente. Como se definió en el ADR de Arquitectura, este es un microservicio.

**Alternativas**:
1. **Replicación de Componentes (Activa/Pasiva)**:
    - Crear múltiples instancias idénticas del microservicio de Ideas y distribuir el tráfico entre ellas con un Balanceador de Carga. Todas las instancias activas pueden recibir peticiones.
    - Permite la **Escalabilidad Horizontal**, que es ideal para picos de tráfico inesperados.
2. **Asignación de Recursos (Incremento Vertical)**:
    - Aumentar la capacidad de la única instancia del servidor (más CPU, más RAM).
    - Limitado por la capacidad máxima del servidor y requiere *downtime* para aplicar cambios.

**Criterios de Elección**:
- Manejar picos masivos de tráfico sin degradación del servicio.
- Cumplir con la medida de respuesta de **Disponibilidad ≥ 90%** durante el pico.
- Compatibilidad con la arquitectura de microservicios.

**Decisión**:
- Se elige la táctica de **Replicación de Componentes** en modo activo, combinada con Balanceo de Carga L7 (*Application Load Balancer*).

**Sustento**:
- La **Replicación de Componentes** (Escalamiento Horizontal) es la forma más efectiva y sencilla de asegurar que el Módulo de Ideas pueda absorber la carga masiva (ESC-02). El Balanceador de Carga distribuirá las solicitudes entre las réplicas del servicio. Si una instancia falla, el *load balancer* la saca de la rotación, manteniendo la disponibilidad requerida. Esto es un estándar de la industria que se implementa fácilmente en plataformas *cloud* (como se mencionó en la ADR de CDN).

---

## Escenario
| Atributo | ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Seguridad** | **ESC-06** | Atacante externo / bot | Atacante realiza fuerza bruta o spam de ideas | Servidor de procesamiento de ideas | Acceso externo no autorizado | El sistema bloquea, detecta y registra intentos | Bloqueo ≤ 2 seg, registro en bitácora | Protege datos y reputación de la plataforma |

### Táctica Elegida
La táctica elegida es **Limitar el Acceso**, específicamente mediante la técnica de *Rate Limiting* (Limitación de Tasa).

**Título**:
- Implementación de Limitación de Tasa (*Rate Limiting*) para mitigar Ataques de Fuerza Bruta y Spam (ESC-06).

**Contexto**:
- El endpoint de creación de ideas (HU001) y el de inicio de sesión (Módulo 1, pero relevante para ataques) son vulnerables al *spam* o ataques de fuerza bruta (ESC-06). Se requiere una respuesta rápida (bloqueo en ≤ 2 seg) para proteger la integridad del sistema y evitar la sobrecarga de recursos.

**Alternativas**:
1. **Limitar el Acceso (Rate Limiting)**:
    - Restringir la cantidad de solicitudes que una IP o un usuario autenticado puede realizar a un endpoint específico (ej. `/api/v1/ideas/create`) dentro de un periodo de tiempo.
    - Es la forma más rápida y sencilla de mitigar ataques de fuerza bruta y spam de ideas.
2. **Autorización y Autenticación Robustas**:
    - Implementar doble factor de autenticación o políticas de contraseñas complejas.
    - Necesario, pero no previene ataques de *bots* no autenticados o usuarios maliciosos que ya han iniciado sesión.

**Criterios de Elección**:
- Rapidez de respuesta ante el ataque (≤ 2 seg).
- Eficiencia para proteger recursos de procesamiento.
- Simplicidad de implementación a nivel de API Gateway o *Load Balancer*.

**Decisión**:
- Se elige la táctica de **Limitar el Acceso (Rate Limiting)** en el *API Gateway* que antecede al microservicio de Ideas.

**Sustento**:
- La implementación de *Rate Limiting* en la capa de infraestructura es la solución más rápida y eficiente para el escenario ESC-06. Permite detectar un patrón de solicitudes excesivas (ej. más de 5 creaciones de ideas por minuto por IP) y bloquearlas en un tiempo casi instantáneo (≤ 2 seg), protegiendo la reputación y la disponibilidad de los recursos del servidor de ideas. Esto se complementa con la **Bitácora** para el registro del evento.

---

## Escenario
| Atributo | ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Testabilidad** | **ESC-09** | Equipo QA | QA ejecuta pruebas automatizadas en flujos críticos | Entorno de pruebas del Módulo de Publicación de Ideas | Ejecución en ambiente de staging | Soporta datos simulados, logs completos y trazabilidad | Respuesta ≤ 2 seg por caso, 100% cobertura de logs | Detecta defectos temprano y asegura calidad continua |

### Táctica Elegida
La táctica elegida es **Separar Preocupaciones** (Separar *Concerns*), aplicando un diseño modular o por capas.

**Título**:
- Adopción del Patrón *Model-View-Controller* (MVC) para maximizar la Testabilidad (ESC-09).

**Contexto**:
- Para que el equipo de QA pueda ejecutar pruebas automatizadas de forma rápida y confiable (Respuesta ≤ 2 seg por caso), la lógica de negocio debe ser probada de forma aislada de las dependencias (ej. base de datos, API externas). Esto requiere una estructura interna del microservicio que facilite la simulación (*mocking*) de dependencias.

**Alternativas**:
1. **Separar Preocupaciones (Modelo por Capas / MVC)**:
    - Dividir el código del microservicio en capas lógicas (Controladores, Servicios/Lógica de Negocio, Repositorios/Acceso a Datos).
    - Permite probar la **Lógica de Negocio** de forma aislada al simular la capa de acceso a datos o las dependencias externas (API).
2. **Generación de Entorno de Prueba Dedicado**:
    - Crear una copia completa del ambiente de producción para cada prueba.
    - Alto costo y lentitud, no apto para pruebas unitarias ni para cumplir con el tiempo de respuesta rápido (≤ 2 seg).

**Criterios de Elección**:
- Aislamiento de la lógica para pruebas unitarias rápidas.
- Facilidad para crear datos simulados (*mocks*).
- Compatibilidad con la arquitectura de microservicios elegida.

**Decisión**:
- Se elige la táctica de **Separar Preocupaciones** mediante la implementación del patrón **MVC** (o Patrón de Repositorio/Servicio) dentro del microservicio de Ideas.

**Sustento**:
- Al dividir el microservicio, la **lógica de validación de campos** (RF002) y la **gestión de estados** (RF010) residen en la capa de servicios, separada del controlador HTTP (View/API) y del repositorio de datos (Model). Esto permite al equipo de QA probar los flujos críticos con *mocks* de datos, logrando una **respuesta rápida (≤ 2 seg)** por caso de prueba y facilitando la cobertura de *logs* y la trazabilidad, satisfaciendo el escenario ESC-09.

---

## Escenario
| Atributo | ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Mantenibilidad** | **ESC-10** | Equipo de desarrollo | Se requiere agregar un nuevo componente funcional | Módulo de Publicación de Ideas | Ciclo de evolución del sistema | Integración de nuevo módulo con bajo impacto | Integración ≤ 3 días, < 5% refactorización existente | Facilita evolución y sostenibilidad |

### Táctica Elegida
La táctica elegida es **Separar Interfaz de Implementación (Abstracción)**, usando Interfaces o Contratos.

**Título**:
- Uso de Abstracción de Contratos (Interfaces) para garantizar la Modificabilidad (ESC-10).

**Contexto**:
- NEXUS está en constante evolución. Se prevé la necesidad de agregar nuevas funcionalidades (ej. un módulo de "Recomendación de Ideas" que consulte las publicaciones existentes). El requisito (ESC-10) es que la integración de nuevos componentes sea rápida (≤ 3 días) y que la refactorización del código existente del Módulo 2 sea mínima (< 5%).

**Alternativas**:
1. **Separar Interfaz de Implementación (Abstracción)**:
    - Definir **Interfaces o Contratos de Servicio** claros y estables (*Design by Contract*). Los nuevos módulos (el que consume) solo interactúan con el contrato, no con la implementación interna del servicio de Ideas (el que provee).
    - Si se cambia la base de datos interna de Ideas (ADR 4), la interfaz no necesita cambiar.
2. **Limitar las Opciones (Estandarización)**:
    - Estandarizar tecnologías y *frameworks*.
    - Si bien ayuda a la mantenibilidad del equipo, no asegura que la lógica de negocio existente no se rompa al integrar un nuevo componente.

**Criterios de Elección**:
- Reducir el acoplamiento entre el Módulo de Ideas y los futuros módulos que lo consumen.
- Minimizar el impacto (refactorización < 5%) en el código existente al evolucionar.
- Facilitar la integración rápida de nuevas funcionalidades.

**Decisión**:
- Se elige la táctica de **Separar Interfaz de Implementación (Abstracción)**, obligando a que la comunicación del microservicio de Ideas se realice a través de un contrato API bien documentado.

**Sustento**:
- Al tener una interfaz pública estable (el *contrato* de la API REST o gRPC), el equipo puede desarrollar nuevos componentes funcionales (Módulo de Recomendación, por ejemplo) basándose únicamente en dicho contrato. Si el equipo del Módulo 2 necesita refactorizar internamente su código o cambiar el modelo NoSQL (Decisión 4), esto no afecta a los consumidores, lo que garantiza el requisito de **< 5% de refactorización** y permite una **integración rápida (≤ 3 días)**.


---

[⬅️ Anterior](../5.3/5.3.md) | [🏠 Home](../../README.md) | [Siguiente ➡️](../5.5/5.5.md)