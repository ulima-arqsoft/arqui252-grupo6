> [5. Tácticas](../../5.md) › [5.6. Listado Consolidado](../5.6.md) › [5.6.4. Tácticas de Rendimiento](5.6.4.md)

# 5.6.4. Tácticas de Rendimiento

## Escenario
| Atributo | ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Rendimiento** | **ESC-01** | Usuario realizando búsqueda | Usuario ejecuta búsqueda con palabra clave en base con 10k ideas | Motor de búsqueda del Módulo de Búsqueda de Ideas | Base de datos con 10,000 ideas indexadas | El sistema devuelve resultados ordenados por relevancia | Tiempo de respuesta p95 ≤ 1 seg | Garantiza experiencia fluida en búsquedas básicas |

### Táctica Elegida
La táctica elegida es **Introducir Concurrencia**, específicamente mediante el uso de índices invertidos y procesamiento paralelo de consultas.

**Título**:
- Táctica de Indexación Avanzada con Elasticsearch para Optimización de Búsquedas (ESC-01).

**Contexto**:
- Los usuarios de NEXUS necesitan encontrar ideas relevantes rápidamente mediante palabras clave (HU001). El requisito funcional **RF001** exige un tiempo de respuesta p95 ≤ 1s con 10k ideas. Las búsquedas full-text en bases de datos relacionales o búsquedas secuenciales son insuficientes para cumplir esta métrica bajo carga concurrente.

**Alternativas**:
1. **Introducir Concurrencia (Índices Invertidos + Procesamiento Paralelo)**:
    - Utilizar Elasticsearch con índices invertidos que permiten búsquedas full-text en tiempo casi constante O(1) para la localización de términos. El motor distribuye la consulta entre múltiples shards procesados en paralelo.
    - Proporciona búsquedas sub-segundo incluso con millones de documentos, scoring de relevancia avanzado (BM25).
2. **Incrementar Recursos Disponibles (Escalamiento Vertical)**:
    - Aumentar CPU y RAM del servidor de base de datos para acelerar consultas secuenciales.
    - Limitado por capacidad máxima del hardware, no resuelve el problema algorítmico de búsqueda full-text.

**Criterios de Elección**:
- Cumplir con métrica de rendimiento p95 ≤ 1s bajo carga concurrente.
- Escalabilidad horizontal para crecimiento futuro.
- Calidad de resultados con scoring de relevancia.

**Decisión**:
- Se elige la táctica de **Introducir Concurrencia** mediante Elasticsearch con arquitectura de sharding y réplicas.

**Sustento**:
- Los **índices invertidos** de Elasticsearch permiten localizar documentos que contienen términos específicos en tiempo casi constante. El procesamiento distribuido entre shards procesa la consulta en paralelo, agregando resultados finales. Con 3 shards primarios y 2 réplicas, el sistema puede procesar búsquedas concurrentes eficientemente, garantizando el **p95 ≤ 1s** requerido por RF001. Esta arquitectura escala horizontalmente agregando más nodos al clúster.
---
## Escenario
| Atributo | ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Rendimiento** | **ESC-02** | Usuario escribiendo en buscador | Usuario escribe consulta y activa autocompletado | Servicio de autocompletado del módulo | Interacción en tiempo real | El sistema muestra sugerencias relevantes sin duplicados | Tiempo de respuesta p95 ≤ 150 ms | Crítico para UX moderna y búsqueda predictiva |

### Táctica Elegida
La táctica elegida es **Incrementar Recursos Disponibles**, específicamente mediante el uso de caché distribuida (Redis) para consultas frecuentes.

**Título**:
- Implementación de Caché Distribuida para Autocompletado de Alta Velocidad (ESC-02).

**Contexto**:
- El autocompletado es una funcionalidad crítica para la experiencia de usuario (HU008). El requisito **RF005** exige p95 ≤ 150ms, lo cual es muy exigente. Consultar Elasticsearch directamente para cada pulsación de tecla consume recursos y puede no cumplir la métrica bajo carga alta.

**Alternativas**:
1. **Incrementar Recursos Disponibles (Caché Distribuida - Redis)**:
    - Precomputar y almacenar en Redis las sugerencias más frecuentes organizadas por prefijos (Trie structure). Las consultas de autocompletado golpean primero la caché.
    - Latencia sub-milisegundo desde Redis, reduce carga en Elasticsearch significativamente.
2. **Mantener Múltiples Copias (Réplicas de Elasticsearch)**:
    - Aumentar réplicas de Elasticsearch para distribuir carga de autocompletado.
    - Mayor costo de infraestructura, latencia sigue siendo mayor que caché en memoria.

**Criterios de Elección**:
- Cumplir con métrica ultra-exigente p95 ≤ 150ms.
- Reducir carga en Elasticsearch para optimizar costos.
- Experiencia de usuario fluida sin lag perceptible.

**Decisión**:
- Se elige la táctica de **Incrementar Recursos Disponibles** mediante caché distribuida Redis con estructura Trie para prefijos.

**Sustento**:
- Redis proporciona latencias de **< 1ms** para operaciones de lectura en memoria. Implementando una estructura Trie con los términos y prefijos más frecuentes (actualizada cada 5 minutos), el 80% de las consultas de autocompletado se resuelven desde caché. Para consultas no cacheadas, se ejecuta contra Elasticsearch con n-grams precomputados. Esta arquitectura híbrida garantiza el **p95 ≤ 150ms** requerido por RF005, mejorando significativamente la UX.
---
## Escenario
| Atributo | ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Rendimiento** | **ESC-05** | Múltiples usuarios simultáneos | 500+ usuarios realizan búsquedas complejas concurrentemente | Servidor de búsqueda y base de datos | Pico de tráfico en horario prime | El sistema mantiene tiempos de respuesta aceptables mediante caché e indexación | p95 ≤ 2 seg, p99 ≤ 3 seg | Asegura escalabilidad en momentos de alta demanda |

### Táctica Elegida
La táctica elegida es **Mantener Múltiples Copias**, específicamente mediante replicación activa de servicios y sharding de datos.

**Título**:
- Implementación de Escalamiento Horizontal con Replicación y Sharding para Alta Concurrencia (ESC-05).

**Contexto**:
- NEXUS espera picos de tráfico durante eventos de marketing o lanzamientos importantes. El Módulo 1 debe soportar 500+ usuarios realizando búsquedas complejas (múltiples filtros, ordenamiento) simultáneamente, manteniendo p95 ≤ 2s y p99 ≤ 3s.

**Alternativas**:
1. **Mantener Múltiples Copias (Replicación + Sharding)**:
    - Desplegar múltiples instancias del microservicio de búsqueda con balanceador de carga (ALB). Configurar Elasticsearch con 3 shards primarios y 2 réplicas por shard distribuidas en 3 nodos.
    - Distribuye carga entre réplicas de servicio y paraleliza consultas entre shards de datos.
2. **Incrementar Recursos (Escalamiento Vertical)**:
    - Aumentar capacidad de servidor único con más CPU/RAM.
    - Límite físico de hardware, punto único de falla, mayor costo por unidad de capacidad.

**Criterios de Elección**:
- Soportar 500+ usuarios concurrentes sin degradación.
- Cumplir métricas p95 ≤ 2s, p99 ≤ 3s bajo pico de carga.
- Elasticidad para crecer/decrecer según demanda.

**Decisión**:
- Se elige la táctica de **Mantener Múltiples Copias** mediante auto-scaling horizontal del microservicio y arquitectura distribuida de Elasticsearch.

**Sustento**:
- Desplegando el microservicio en **Kubernetes con HPA** (Horizontal Pod Autoscaler) configurado para escalar de 2 a 10 réplicas basado en CPU > 70% y latencia p95, el sistema distribuye automáticamente la carga. Elasticsearch con **3 shards primarios + 2 réplicas** distribuye consultas en paralelo entre 9 copias de datos (3×3). Un Application Load Balancer distribuye tráfico con round-robin entre réplicas de servicio. Esta arquitectura garantiza **p95 ≤ 2s** y **p99 ≤ 3s** durante picos de 500+ usuarios concurrentes, cumpliendo ESC-05.
---
## Escenario
| **Atributo** | **ID Escenario** | **Fuente Estímulo** | **Estímulo** | **Artefacto** | **Entorno** | **Respuesta** | **Medida de Respuesta** | **Comentario** |
|---------------|------------------|----------------------|---------------|----------------|--------------|----------------|--------------------------|----------------|
| **Rendimiento** | ESC-02 | Múltiples usuarios concurrentes | Carga masiva al listar y filtrar ideas publicadas | Servidor del Módulo de Gestión de Ideas | Evento de alta concurrencia | Respuesta mantiene tiempo aceptable mediante caché y réplicas | Tiempo de respuesta ≤ 2 seg con 500 usuarios concurrentes | Asegura escalabilidad y experiencia fluida |

### **Táctica Elegida**
La táctica elegida es **Replicación Activa y Caching** para mantener el rendimiento bajo alta concurrencia.

**Título:**
- *Uso de Replicación Activa y Caching para mejorar rendimiento bajo alta concurrencia (ESC-02).*

**Contexto:**
Durante lanzamientos o eventos, el módulo puede recibir miles de solicitudes simultáneas al listar ideas, lo que exige optimizar consultas y distribución de carga.

**Alternativas:**
- **Replicación Activa (Escalamiento Horizontal):** Multiplicar instancias del microservicio y balancear carga.  
- **Caching de Consultas (Redis / Memory Cache):** Guardar resultados frecuentes de búsquedas o listados.

**Criterios de Elección:**
- Tiempo de respuesta ≤ 2 seg  
- Eficiencia en picos de tráfico  
- Uso óptimo de infraestructura  

**Decisión:**
Se combinan ambas tácticas: **Replicación Activa** para escalar horizontalmente y **Caching Redis** para reducir tiempos de respuesta.

**Sustento:**
Garantiza disponibilidad ≥ 90% y respuesta ≤ 2 seg en escenarios de alta concurrencia sin comprometer la integridad del sistema.

---
## Escenario
| Atributo | ID Escenario | Fuente Estímulo | Estímulo | Artefacto | Entorno | Respuesta | Medida de Respuesta | Comentario |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Rendimiento** | **ESC-02** | Carga masiva de usuarios | Pico masivo de tráfico con miles de usuarios concurrentes | Servidor principal del Módulo de Publicación de Ideas | Evento de alta concurrencia | El sistema escala horizontalmente manteniendo respuesta aceptable | Disponibilidad ≥ 90% | Garantiza confiabilidad en momentos críticos |

### Táctica Elegida
La táctica elegida es **Replicación de Componentes** (Escalamiento Horizontal), que permite distribuir la carga de las solicitudes de creación y edición.

**Título**:
- Uso de Replicación Activa para Escalamiento Horizontal en el Microservicio de Ideas (ESC-02).

**Contexto**:
- NEXUS espera picos de tráfico ante eventos de marketing o grandes lanzamientos (ESC-02). El Módulo 2 debe manejar miles de usuarios creando y editando ideas simultáneamente. Como se definió en el ADR de Arquitectura, este es un microservicio.

**Alternativas**:
1. **Replicación de Componentes (Activa/Pasiva)**:
    - Crear múltiples instancias idénticas del microservicio de Ideas y distribuir el tráfico entre ellas con un Balanceador de Carga. Todas las instancias activas pueden recibir peticiones.
    - Permite la **Escalabilidad Horizontal**, que es ideal para picos de tráfico inesperados.
2. **Asignación de Recursos (Incremento Vertical)**:
    - Aumentar la capacidad de la única instancia del servidor (más CPU, más RAM).
    - Limitado por la capacidad máxima del servidor y requiere *downtime* para aplicar cambios.

**Criterios de Elección**:
- Manejar picos masivos de tráfico sin degradación del servicio.
- Cumplir con la medida de respuesta de **Disponibilidad ≥ 90%** durante el pico.
- Compatibilidad con la arquitectura de microservicios.

**Decisión**:
- Se elige la táctica de **Replicación de Componentes** en modo activo, combinada con Balanceo de Carga L7 (*Application Load Balancer*).

**Sustento**:
- La **Replicación de Componentes** (Escalamiento Horizontal) es la forma más efectiva y sencilla de asegurar que el Módulo de Ideas pueda absorber la carga masiva (ESC-02). El Balanceador de Carga distribuirá las solicitudes entre las réplicas del servicio. Si una instancia falla, el *load balancer* la saca de la rotación, manteniendo la disponibilidad requerida. Esto es un estándar de la industria que se implementa fácilmente en plataformas *cloud* (como se mencionó en la ADR de CDN).

---

[⬅️ Anterior](../5.6.3/5.6.3.md) | [🏠 Home](../../../README.md) | [Siguiente ➡️](../5.6.5/5.6.5.md)