> [5. T√°cticas](../5.md) ‚Ä∫ [5.5. M√≥dulo 5 / Integrante 5](5.5.md)

# 5.5. M√≥dulo 5 / Integrante 5

## T√°cticas Arquitect√≥nicas ‚Äî Gesti√≥n de Perfiles de Usuario

Este documento detalla las t√°cticas arquitect√≥nicas adoptadas para el **M√≥dulo 5 ‚Äî Gesti√≥n de Perfiles de Usuario** (NEXUS).  
Se presenta cada t√°ctica alineada a escenarios de calidad (ESC-34 ‚Üí ESC-45) y a las decisiones t√©cnicas (DT1 ‚Üí DT5) definidas en la ADR del m√≥dulo.

---

## Resumen ejecutivo
- **Objetivo:** Proveer gesti√≥n segura, disponible y r√°pida de perfiles de usuario (visualizaci√≥n, edici√≥n, imagen, preferencias y m√©tricas asociadas).  
- **Stack t√©cnico principal (decisiones):** SQL Server (datos primarios) + MongoDB (metadatos/m√©tricas), Node.js + Express + JWT, React + RxJS + Socket.IO, respaldo en la nube (Supabase/Azure).  
- **Atributos cubiertos:** Seguridad, Disponibilidad, Rendimiento, Usabilidad, Trazabilidad y Mantenibilidad.

---

### Decisi√≥n/T√°ctica 1 ‚Äî Modelo de Datos H√≠brido y Caching Estrat√©gico
**Decisi√≥n t√©cnica relacionada:** DT1 (Modelo h√≠brido: SQL Server + MongoDB)  
**Atributo de calidad:** Rendimiento / Escalabilidad / Consistencia  
**Escenarios relacionados:** ESC-34 (accesos), ESC-43 (alto volumen)

**Escenario (s√≠ntesis):**
| Est√≠mulo | Artefacto | Entorno | Respuesta | Medida |
|---|---:|---|---|---:|
| Lecturas frecuentes y consultas agregadas sobre perfiles y m√©tricas | API de Perfiles / almac√©n de m√©tricas | Producci√≥n con concurrencia | Se sirve desde cache intermedia y/o documento parcial | Tiempo de respuesta ‚â§ 150‚Äì200 ms (p95) |

**T√°ctica aplicada:**  
- **Modelo h√≠brido:** datos est√°ticos y cr√≠ticos (ID, email, roles) en SQL Server; datos extendidos y m√©tricas en MongoDB.  
- **Cache intermedia (Redis):** cachear respuestas de perfil y fragmentos de m√©tricas; TTL configurable y invalidaci√≥n a escritura.  
- **Cache en cliente (IndexedDB/LocalStorage):** para perfiles visitados recientemente en modo offline.

**Sustento:**  
- Reduce latencia de lectura y descarga la base relacional para cargas altas (ESC-43).  
- Mantiene integridad de identidad y permite actualizaciones parciales r√°pidas en MongoDB (DT1).

---

### Decisi√≥n/T√°ctica 2 ‚Äî Autenticaci√≥n JWT con Control de Roles y Protecci√≥n de Endpoints
**Decisi√≥n t√©cnica relacionada:** DT2 (JWT + middleware de roles)  
**Atributo de calidad:** Seguridad / Usabilidad  
**Escenarios relacionados:** ESC-34, ESC-36, ESC-42

**Escenario (s√≠ntesis):**
| Est√≠mulo | Artefacto | Entorno | Respuesta | Medida |
|---|---:|---|---|---:|
| Intento de acceso no autorizado a datos de perfil | API de autenticaci√≥n y control de acceso | Producci√≥n | Rechazo, registro y notificaci√≥n | 100% accesos no autorizados bloqueados (ESC-34) |

**T√°ctica aplicada:**  
- **JWT firmado + middleware** que valida token, roles y claims antes de cada operaci√≥n.  
- **Policy enforcement** para acciones sensibles (editar, ver campos privados).  
- **Rotaci√≥n / revocaci√≥n:** implementada via blacklist en Redis para revocar tokens de ser necesario.

**Sustento:**  
- JWT ofrece escalabilidad stateless (DT2) y permite validaci√≥n descentralizada entre microservicios.  
- Complementar con TLS 1.3 obligatorio (ESC-42) y auditor√≠a de intentos fallidos (ESC-35).

---

### Decisi√≥n/T√°ctica 3 ‚Äî Detecci√≥n de Exfiltraci√≥n y Protecci√≥n ante Archivos Maliciosos
**Decisiones t√©cnicas relacionadas:** DT1 (datos), DT4 (respaldo)  
**Atributo de calidad:** Seguridad / Recuperaci√≥n  
**Escenarios relacionados:** ESC-35 (extracci√≥n masiva), ESC-39 (archivos maliciosos)

**Escenario (s√≠ntesis):**
| Est√≠mulo | Artefacto | Entorno | Respuesta | Medida |
|---|---:|---|---|---:|
| Detecci√≥n de patr√≥n de extracci√≥n masiva o subida de archivo sospechoso | Bases de datos / M√≥dulo de carga de archivos | Operaci√≥n de alto volumen | Alerta autom√°tica, bloqueo temporal y registro detallado | Alerta ‚â§ 5 s, bloqueo ‚â§ 10 s (ESC-35) / 100% archivos maliciosos detectados (ESC-39) |

**T√°ctica aplicada:**  
- **Rate limiting** y **WAF** en API Gateway + **monitoring de patrones** (thresholds) que disparan acciones (bloqueo IP, captchas, throttling).  
- **An√°lisis de archivos en pipeline**: escaneo en upload (antivirus / sandbox), rechazo/aislamiento de archivos maliciosos, registro en tabla de incidentes.  
- **Alertas y playbooks** para analistas (integraci√≥n con SIEM).

**Sustento:**  
- Responde a ESC-35/ESC-39 con tiempos de reacci√≥n medibles y protecci√≥n proactiva; mantiene integridad de datos y reputaci√≥n del servicio.

---

### Decisi√≥n/T√°ctica 4 ‚Äî Sincronizaci√≥n Reactiva y Recuperaci√≥n de Estado
**Decisi√≥n t√©cnica relacionada:** DT3 (REST + WebSockets / RxJS)  
**Atributo de calidad:** Disponibilidad / Usabilidad / Rendimiento  
**Escenarios relacionados:** ESC-37 (reconexi√≥n), ESC-40 (priorizaci√≥n under load), ESC-41 (m√©tricas en tiempo real)

**Escenario (s√≠ntesis):**
| Est√≠mulo | Artefacto | Entorno | Respuesta | Medida |
|---|---:|---|---|---:|
| P√©rdida temporal de conexi√≥n entre m√≥dulos o m√∫ltiples dispositivos | Servicios de sincronizaci√≥n (Socket.IO) | Ambientes distribuidos | Reconexi√≥n y re-sincronizaci√≥n autom√°tica del estado | Recuperaci√≥n ‚â§ 5 s (ESC-37); m√©tricas ‚â§ 1 s (ESC-41) |

**T√°ctica aplicada:**  
- **WebSockets (Socket.IO) + Pub/Sub (Redis)** para propagar eventos de cambio de perfil y m√©tricas en tiempo real entre instancias.  
- **Buffer y reintentos en cliente**: autosave en IndexedDB y reenviar cambios al reconectar.  
- **Prioridad de mensajes**: priorizar eventos cr√≠ticos (ej. cambio de permisos) frente a m√©tricas informativas cuando hay congesti√≥n (ESC-40).

**Sustento:**  
- DT3 asegura experiencia reactiva; buffers y reenviadores garantizan que ESC-37 se cumpla.  
- Pub/Sub con Redis permite escalado entre nodos y coordinaci√≥n de sessions.

---

### Decisi√≥n/T√°ctica 5 ‚Äî Auditor√≠a, Versionado y Backup Seguro
**Decisi√≥n t√©cnica relacionada:** DT4 (Respaldo centralizado)  
**Atributo de calidad:** Trazabilidad / Recuperaci√≥n / Seguridad  
**Escenarios relacionados:** ESC-36 (cambios de permisos), ESC-45 (restauraci√≥n)

**Escenario (s√≠ntesis):**
| Est√≠mulo | Artefacto | Entorno | Respuesta | Medida |
|---|---:|---|---|---:|
| Revisi√≥n forense o restauraci√≥n tras fallo | Base de datos y sistema de backup | Entorno cr√≠tico | Registro detallado + restauraci√≥n desde backup versionado | Restauraci√≥n completa ‚â§ 15 s (ESC-45) |

**T√°ctica aplicada:**  
- **Logging estructurado** (Winston/ELK o similar) para cada cambio cr√≠tico (qui√©n, cu√°ndo, qu√© campos, antes/despu√©s).  
- **Tabla `historial_perfiles`** con versi√≥n de entidad y metadatos para rollback.  
- **Backups versionados en la nube** (Supabase Storage / Azure Backup) con pol√≠ticas de retenci√≥n y pruebas de restauraci√≥n peri√≥dicas.

**Sustento:**  
- Permite auditor√≠a legal y operativa (ESC-36) y soporta restauraciones r√°pidas (DT4).

---

### Decisi√≥n/T√°ctica 6 ‚Äî Escalado Horizontal, Balanceo y Observabilidad
**Decisiones t√©cnicas relacionadas:** DT1 (escalabilidad de datos) y DT3 (sincronizaci√≥n)  
**Atributo de calidad:** Disponibilidad / Rendimiento / Operabilidad  
**Escenarios relacionados:** ESC-38 (failover autom√°tico), ESC-40 (sobre carga), ESC-43 (alto volumen)

**Escenario (s√≠ntesis):**
| Est√≠mulo | Artefacto | Entorno | Respuesta | Medida |
|---|---:|---|---|---:|
| Falla de una instancia o pico de uso masivo | Backend / Nginx / Kubernetes / PM2 | Producci√≥n | Balanceo, conmutaci√≥n a respaldo y autoescalado | Downtime ‚â§ 10 s (ESC-38); Latencia ‚â§ 3 s bajo carga (ESC-40) |

**T√°ctica aplicada:**  
- **Instancias stateless** del servicio de perfiles con **balanceador L7 (Nginx/ALB)** y **autoescalado** (K8s/Cloud).  
- **socket.io-redis-adapter** para sincronizar WebSockets entre r√©plicas.  
- **Metricas y alertas (Prometheus + Grafana)**: latencias, error rates, uso CPU/memoria.  
- **Playbook de conmutaci√≥n** para failover r√°pido.

**Sustento:**  
- Cumple ESC-38/40/43; observabilidad garantiza detecci√≥n temprana y acciones autom√°ticas.

---

### Decisi√≥n/T√°ctica 7 ‚Äî UX/SPA, Validaci√≥n y Optimizaci√≥n de Im√°genes
**Decisi√≥n t√©cnica relacionada:** DT5 (SPA React + Tailwind)  
**Atributo de calidad:** Usabilidad / Rendimiento / Accesibilidad  
**Escenarios relacionados:** ESC-41 (m√©tricas en panel admin), ESC-38 (cambios sin downtime), ESC-43 (respuesta bajo carga)

**Escenario (s√≠ntesis):**
| Est√≠mulo | Artefacto | Entorno | Respuesta | Medida |
|---|---:|---|---|---:|
| Usuario edita perfil o sube avatar desde m√≥vil/desktop | Frontend SPA | Red variada | UI reactiva, validaciones instant√°neas y compresi√≥n de imagen previa | Lighthouse ‚â• 90; imagen < 500 KB |

**T√°ctica aplicada:**  
- **React SPA + RxJS** para enlaces reactivos de UI.  
- **Validaci√≥n en cliente (Zod/Yup)** y validaci√≥n server-side.  
- **Compresi√≥n y transformaci√≥n (Sharp / CDN / Cloudinary)** en pipeline de upload.  
- **Accessibility (WCAG)**: tap targets, ARIA roles y tests automatizados.

**Sustento:**  
- Mejor UX, reduce roundtrips y protege contra inputs maliciosos; atiende ESC-38/41/43.
---

[‚¨ÖÔ∏è Anterior](../4.5/4.5.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../5.6/5.6.md)


[‚¨ÖÔ∏è Anterior](../5.4/5.4.md) | [üè† Home](../../README.md) | [Siguiente ‚û°Ô∏è](../5.6/5.6.md)
