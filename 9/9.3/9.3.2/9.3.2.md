> [9. Metodolog√≠a de Dise√±o de Arquitectura - Aplicaci√≥n de ADD](../../9.md) ‚Ä∫ [9.3. Iteraci√≥n 2: Identificar estructuras para soportar la funcionalidad primaria](../9.3.md) ‚Ä∫ [9.3.2. Elementos a refinar](9.3.2.md)

# 9.3.2. Elementos a refinar

## Elementos a Refinar

En esta iteraci√≥n, los elementos a refinar son **los 5 microservicios** definidos en la Iteraci√≥n 1. Cada microservicio se descompondr√° en componentes internos que implementar√°n los casos de uso asignados.

---

### Microservicio 1: Perfil (nexus-profile-service)

**Responsabilidad**: Autenticaci√≥n, gesti√≥n de usuarios y roles

**Casos de Uso a Soportar**:
- CU01: Registro de usuario
- CU02: Inicio de sesi√≥n
- CU03: Cierre de sesi√≥n
- CU12: Gesti√≥n de usuarios y salas (admin)
- CU13: Dashboard de actividad (admin)

**Descomposici√≥n Propuesta**:
- **AuthController**: Endpoints de autenticaci√≥n (register, login, logout)
- **UserController**: Endpoints de gesti√≥n de usuarios
- **AdminController**: Endpoints administrativos
- **AuthService**: L√≥gica de autenticaci√≥n y generaci√≥n de JWT
- **UserService**: L√≥gica de gesti√≥n de perfiles y habilidades
- **AdminService**: L√≥gica de administraci√≥n
- **UserRepository**: Acceso a datos de usuarios (PostgreSQL)
- **JwtAdapter**: Generaci√≥n y validaci√≥n de tokens
- **BcryptAdapter**: Hashing de contrase√±as
- **SendGridAdapter**: Env√≠o de emails de bienvenida
- **EventPublisher**: Publicaci√≥n de eventos (UserRegistered, UserUpdated)

---

### Microservicio 2: Ideas (nexus-ideas-service)

**Responsabilidad**: Publicaci√≥n y gesti√≥n de ideas y proyectos

**Casos de Uso a Soportar**:
- CU04: Registrar idea
- CU11: Calificar impacto de una idea (comentarios/ratings)

**Descomposici√≥n Propuesta**:
- **IdeaController**: Endpoints CRUD de ideas
- **ProjectController**: Endpoints de proyectos
- **CommentController**: Endpoints de comentarios
- **IdeaService**: L√≥gica de negocio de ideas
- **ProjectService**: L√≥gica de conversi√≥n idea ‚Üí proyecto
- **CommentService**: L√≥gica de comentarios y ratings
- **IdeaRepository**: Acceso a MongoDB (colecci√≥n ideas)
- **ProjectRepository**: Acceso a MongoDB (colecci√≥n projects)
- **S3Adapter**: Subida de im√°genes/archivos a AWS S3
- **EventPublisher**: Publicaci√≥n de eventos (IdeaCreated, IdeaUpdated, IdeaDeleted)

---

### Microservicio 3: B√∫squeda (nexus-search-service)

**Responsabilidad**: Motor de b√∫squeda y recomendaciones

**Casos de Uso a Soportar**:
- CU05: Explorar ideas (b√∫squeda y filtrado)
- CU10: Sugerir ideas afines (recomendaciones)

**Descomposici√≥n Propuesta**:
- **SearchController**: Endpoints de b√∫squeda y sugerencias
- **SearchService**: L√≥gica de construcci√≥n de queries
- **RecommendationService**: L√≥gica de recomendaciones basadas en perfil
- **ElasticsearchAdapter**: Interfaz con Elasticsearch
- **QueryBuilder**: Constructor de queries DSL de Elasticsearch
- **EventConsumer**: Consumidor de eventos (IdeaCreated, IdeaUpdated, IdeaDeleted)
- **IndexService**: Servicio de indexaci√≥n de ideas

---

### Microservicio 4: Colaboraci√≥n (nexus-collaboration-service)

**Responsabilidad**: Chat en tiempo real, postulaciones, notificaciones

**Casos de Uso a Soportar**:
- CU06: Enviar mensaje en una sala
- CU07: Recibir mensajes en tiempo real
- CU08: Crear/unirse a sala de colaboraci√≥n
- CU09: Ver participantes y estados

**Descomposici√≥n Propuesta**:
- **ChatController**: Endpoints REST de salas y mensajes
- **ApplicationController**: Endpoints de postulaciones a proyectos
- **ChatGateway**: Gateway de WebSocket (Socket.IO)
- **ChatService**: L√≥gica de salas y mensajes
- **ApplicationService**: L√≥gica de postulaciones
- **PresenceService**: Gesti√≥n de usuarios conectados
- **MessageRepository**: Acceso a mensajes (PostgreSQL)
- **RoomRepository**: Acceso a salas (PostgreSQL)
- **ApplicationRepository**: Acceso a postulaciones (PostgreSQL)
- **RedisAdapter**: Pub/Sub para escalado horizontal
- **S3Adapter**: Subida de archivos adjuntos
- **ExpoPushAdapter**: Env√≠o de notificaciones push
- **EventPublisher**: Publicaci√≥n de eventos (MessageSent, ApplicationSubmitted)
- **EventConsumer**: Consumidor de eventos (IdeaCreated ‚Üí crear sala)

---

### Microservicio 5: Pagos (nexus-payments-service)

**Responsabilidad**: Procesamiento de pagos y recompensas

**Casos de Uso Impl√≠citos**:
- Crear intenci√≥n de pago
- Confirmar pago
- Gestionar balance de usuario
- Manejar webhooks de Stripe

**Descomposici√≥n Propuesta**:
- **PaymentController**: Endpoints de pagos
- **BalanceController**: Endpoints de balance de usuario
- **WebhookController**: Endpoint para webhooks de Stripe
- **PaymentService**: L√≥gica de procesamiento de pagos
- **EscrowService**: L√≥gica de fondos en escrow
- **BalanceService**: L√≥gica de balance y transacciones
- **TransactionRepository**: Acceso a transacciones (PostgreSQL)
- **BalanceRepository**: Acceso a balances (PostgreSQL)
- **StripeAdapter**: Integraci√≥n con Stripe API
- **EventPublisher**: Publicaci√≥n de eventos (PaymentCompleted, PaymentFailed)

---

### Patr√≥n de Descomposici√≥n Com√∫n

Todos los microservicios siguen el patr√≥n **Layered Architecture** (Arquitectura en Capas):

![Patr√≥n de Descomposici√≥n Com√∫n](./diagrama/PATRON.png)

**Responsabilidades por Capa**:

| Capa | Responsabilidad | Componentes |
|---|---|---|
| **Presentaci√≥n** | Recibir peticiones HTTP/WebSocket, validar entrada, retornar respuestas | Controllers, Gateways |
| **Aplicaci√≥n** | L√≥gica de negocio, orquestaci√≥n de casos de uso | Services |
| **Dominio** | Modelos de datos, reglas de negocio | Entities, DTOs, Value Objects |
| **Infraestructura** | Acceso a BD, servicios externos, eventos | Repositories, Adapters, Publishers/Consumers |

---

### Criterios de Descomposici√≥n

1. **Separaci√≥n de Responsabilidades**: Cada componente tiene una responsabilidad √∫nica y bien definida
2. **Bajo Acoplamiento**: Componentes se comunican mediante interfaces
3. **Alta Cohesi√≥n**: Componentes relacionados est√°n agrupados
4. **Testabilidad**: Cada componente puede ser testeado de forma aislada
5. **Mantenibilidad**: Cambios en un componente no afectan a otros (ESC-06)

---

[‚¨ÖÔ∏è Anterior](../9.3.1/9.3.1.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../9.3.3/9.3.3.md)