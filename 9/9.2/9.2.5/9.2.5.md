> [9. Metodolog√≠a de Dise√±o de Arquitectura - Aplicaci√≥n de ADD](../../9.md) ‚Ä∫ [9.2. Iteraci√≥n 1: Definir la estructura general del sistema](../9.2.md) ‚Ä∫ [9.2.5. Vistas y Decisiones](9.2.5.md)

# 9.2.5. Vistas y Decisiones

## Vistas y Decisiones

Esta secci√≥n presenta las vistas arquitect√≥nicas resultantes de la Iteraci√≥n 1 y documenta las decisiones clave tomadas.

---

### Vista 1: Diagrama de Contenedores (C4 Level 2)

![Diagrama de Contenedores](./diagrama/CONTENEDORES.png)

---

### Vista 2: Diagrama de Despliegue

![Diagrama de Despliegue](./diagrama/DESPLIEGUE.png)

---

### Vista 3: Flujo de Comunicaci√≥n - Crear Idea y Sala de Chat

![Flujo de Comunicaci√≥n - Crear Idea y Sala de Chat](./diagrama/FLUJO_COMUNICACION.png)

---

### Decisiones Arquitect√≥nicas

#### Decisi√≥n 1: Adopci√≥n de Arquitectura de Microservicios

| Aspecto | Detalle |
|---|---|
| **Contexto** | Sistema con 5 m√≥dulos funcionales independientes, desarrollados por 5 integrantes |
| **Decisi√≥n** | Implementar arquitectura de microservicios con un servicio por m√≥dulo |
| **Alternativas** | Monolito modular, SOA tradicional |
| **Justificaci√≥n** | - Alineaci√≥n con estructura del equipo (CON01)<br/>- Despliegue independiente por integrante<br/>- Escalabilidad diferenciada (chat requiere m√°s recursos)<br/>- Tecnolog√≠as heterog√©neas (SQL, MongoDB, Elasticsearch) |
| **Consecuencias** | ‚úÖ Autonom√≠a de equipos<br/>‚úÖ Escalabilidad granular<br/>‚ö†Ô∏è Complejidad operacional<br/>‚ö†Ô∏è Latencia de red |
| **Mitigaci√≥n** | Contenedores Docker + Kubernetes, cach√© distribuida, comunicaci√≥n as√≠ncrona |

#### Decisi√≥n 2: NGINX como API Gateway

| Aspecto | Detalle |
|---|---|
| **Contexto** | Necesidad de punto de entrada √∫nico para clientes web y m√≥vil |
| **Decisi√≥n** | Usar NGINX como API Gateway con Gateway Offloading |
| **Alternativas** | Kong, AWS API Gateway, Traefik |
| **Justificaci√≥n** | - Experiencia del equipo (Integrante 2 implement√≥ demo)<br/>- Control total sobre configuraci√≥n<br/>- Rendimiento probado<br/>- Sin costos de licencia |
| **Consecuencias** | ‚úÖ Centralizaci√≥n de autenticaci√≥n y rate limiting<br/>‚úÖ Simplicidad para clientes<br/>‚ö†Ô∏è Configuraci√≥n manual (no UI) |
| **Implementaci√≥n** | `auth_request` para validaci√≥n JWT, `limit_req_zone` para rate limiting |

#### Decisi√≥n 3: RabbitMQ para Event-Driven Architecture

| Aspecto | Detalle |
|---|---|
| **Contexto** | Necesidad de desacoplar microservicios y manejar comunicaci√≥n as√≠ncrona |
| **Decisi√≥n** | Implementar RabbitMQ como message broker central |
| **Alternativas** | Apache Kafka, AWS SQS, Redis Pub/Sub |
| **Justificaci√≥n** | - Simplicidad para escala inicial<br/>- Soporte AMQP est√°ndar<br/>- Garant√≠as de entrega (acknowledgments)<br/>- Dead Letter Queues para manejo de errores |
| **Consecuencias** | ‚úÖ Desacoplamiento temporal y l√≥gico<br/>‚úÖ Resiliencia (eventos persisten)<br/>‚ö†Ô∏è Menor throughput que Kafka (aceptable para NEXUS) |
| **Patrones** | Publish-Subscribe para eventos de dominio |

#### Decisi√≥n 4: Persistencia Poliglota

| Aspecto | Detalle |
|---|---|
| **Contexto** | Diferentes microservicios con diferentes necesidades de datos |
| **Decisi√≥n** | Cada microservicio selecciona su BD √≥ptima |
| **Alternativas** | Una sola BD relacional para todo |
| **Justificaci√≥n** | - **PostgreSQL**: Transacciones ACID para Perfil, Colaboraci√≥n, Pagos<br/>- **MongoDB**: Flexibilidad de esquema para Ideas<br/>- **Elasticsearch**: B√∫squeda full-text optimizada<br/>- **Redis**: Cach√© de alto rendimiento y pub/sub |
| **Consecuencias** | ‚úÖ Optimizaci√≥n por tipo de datos<br/>‚úÖ Escalabilidad independiente<br/>‚ö†Ô∏è No hay transacciones distribuidas (dise√±ar bounded contexts) |
| **Restricci√≥n** | Cumple CON05 (PostgreSQL como BD principal para 3 servicios) |

#### Decisi√≥n 5: Comunicaci√≥n H√≠brida (REST + WebSocket + Eventos)

| Aspecto | Detalle |
|---|---|
| **Contexto** | Diferentes patrones de interacci√≥n: CRUD, tiempo real, notificaciones |
| **Decisi√≥n** | Usar REST para operaciones s√≠ncronas, WebSocket para chat, Eventos para integraci√≥n |
| **Alternativas** | Solo REST con polling, solo gRPC |
| **Justificaci√≥n** | - **REST**: Est√°ndar, f√°cil de consumir, stateless<br/>- **WebSocket**: Latencia baja para chat (ESC-01)<br/>- **Eventos**: Desacoplamiento entre servicios (ESC-07) |
| **Consecuencias** | ‚úÖ Cada patr√≥n para su caso de uso √≥ptimo<br/>‚ö†Ô∏è Mayor complejidad en clientes |
| **Restricciones** | Cumple CON03 (REST) y CON04 (WebSocket) |

#### Decisi√≥n 6: Contenedores Docker + Orquestaci√≥n Kubernetes

| Aspecto | Detalle |
|---|---|
| **Contexto** | Necesidad de despliegue consistente y escalable en cloud |
| **Decisi√≥n** | Empaquetar cada microservicio en contenedor Docker, orquestar con Kubernetes |
| **Alternativas** | VMs tradicionales, Docker Swarm, serverless |
| **Justificaci√≥n** | - Portabilidad entre entornos<br/>- Escalado autom√°tico (HPA)<br/>- Self-healing (restart autom√°tico)<br/>- Est√°ndar de industria |
| **Consecuencias** | ‚úÖ Consistencia dev/prod<br/>‚úÖ Escalabilidad autom√°tica<br/>‚ö†Ô∏è Curva de aprendizaje Kubernetes |
| **Restricci√≥n** | Cumple CON06 (despliegue en cloud con contenedores) |

---

### Mapeo de Restricciones a Decisiones

| Restricci√≥n | Decisi√≥n que la Satisface | Evidencia |
|---|---|---|
| CON01: Arquitectura modular | Microservicios (1 por m√≥dulo) | 5 microservicios alineados a m√≥dulos |
| CON02: Stack Node.js, PostgreSQL, React | Tecnolog√≠as seleccionadas | NestJS (Node.js), PostgreSQL, React/RN |
| CON03: Comunicaci√≥n REST | API Gateway + REST | Endpoints REST en todos los microservicios |
| CON04: WebSocket para mensajer√≠a | Socket.IO en MS Colaboraci√≥n | WebSocket para chat en tiempo real |
| CON05: Persistencia PostgreSQL | PostgreSQL para 3 servicios | Perfil, Colaboraci√≥n, Pagos usan PostgreSQL |
| CON06: Despliegue cloud/contenedores | Docker + Kubernetes | Todos los servicios containerizados |
| CON07: Patr√≥n Sharding (Integrante 2) | Redis Pub/Sub para escalado | Socket.IO Redis Adapter (Iteraci√≥n 3) |

---

### Mapeo de Preocupaciones a Decisiones

| Preocupaci√≥n | Decisi√≥n que la Aborda | C√≥mo |
|---|---|---|
| CRN04: Integraci√≥n entre m√≥dulos | Event-Driven Architecture | RabbitMQ permite comunicaci√≥n desacoplada |
| CRN05: Mantenibilidad | Microservicios + Contenedores | Cambios aislados por servicio |
| CRN06: Observabilidad | Logs centralizados (futura) | Preparado para ELK Stack |

---

### An√°lisis de Riesgos

| Riesgo | Probabilidad | Impacto | Mitigaci√≥n |
|---|---|---|---|
| Latencia entre microservicios | Media | Medio | Cach√© Redis, comunicaci√≥n as√≠ncrona |
| Complejidad operacional | Alta | Medio | Kubernetes maneja orquestaci√≥n |
| Fallo de RabbitMQ | Baja | Alto | Cluster RabbitMQ, Dead Letter Queues |
| Inconsistencia de datos | Media | Alto | Dise√±o de bounded contexts, eventual consistency |
| Sobrecarga de API Gateway | Media | Alto | Escalado horizontal de NGINX |

---

### Pr√≥ximos Pasos

En la **Iteraci√≥n 2**, se descompondr√°n los microservicios en componentes internos (Controllers, Services, Repositories) para soportar los casos de uso principales.

---

[‚¨ÖÔ∏è Anterior](../9.2.4/9.2.4.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../9.1.6/9.1.6.md)